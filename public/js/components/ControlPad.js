"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),_ramda=require("ramda"),_react=require("react"),_react2=_interopRequireDefault(_react),_alt=require("../alt"),_alt2=_interopRequireDefault(_alt),_noteController=require("../noteController"),floor=Math.floor,EPSILON=Number.EPSILON,calculatePitch=function(t){var e=_alt2["default"].getStore("ScaleStore").getState(),n=e.scaleName,o=e.scales,a=o[n];return a[floor(a.length*t)]},minZeroMaxOne=_ramda.cond([_ramda.flip(_ramda.lt)(0),_ramda.always(0)],[_ramda.flip(_ramda.gte)(1),_ramda.always(1-EPSILON)],[_ramda.T,_ramda.identity]),calculateXAndYRatio=function(t){var e=t.target.getBoundingClientRect(),n=e.top,o=e.right,a=e.bottom,r=e.left,l=t.changedTouches&&t.changedTouches[0]||t,c=l.clientX,i=l.clientY,u=c-r,d=i-n,s=o-r,p=a-n;return{xRatio:minZeroMaxOne(u/s),yRatio:minZeroMaxOne(d/p)}},calculatePitchAndMod=function(t){var e=t.xRatio,n=t.yRatio;return{pitch:calculatePitch(e),modulation:n}},getNoteFromXYRatios=_ramda.compose(_ramda.assoc("id","controlPad"),calculatePitchAndMod),fadeLoopIsOn=!1,mouseInputEnabled=!1,context=null,controlPadActive=!1,currentlyPlayingPitch=null,currentXYRatios=null,controlPadElement=null,drawTouchCircle=function(){if(controlPadActive){var t=currentXYRatios.xRatio,e=currentXYRatios.yRatio,n=controlPadElement.width,o=controlPadElement.height,a=t*n,r=e*o,l=.08*n,c=context.createRadialGradient(a,r,l,a,r,0);c.addColorStop(0,"rgba(143, 0, 255, 0"),c.addColorStop(.5,"rgba(143, 0, 255, 0.02"),c.addColorStop(1,"rgba(143, 245, 255, 1"),context.fillStyle=c,context.beginPath(),context.arc(a,r,l,0,2*Math.PI,!0),context.closePath(),context.fill()}},ControlPad=function(t){function e(){_classCallCheck(this,e),null!=t&&t.apply(this,arguments)}return _inherits(e,t),_createClass(e,[{key:"componentDidMount",value:function(){controlPadElement=document.querySelector(".control-pad"),context=controlPadElement.getContext("2d");var t=controlPadElement.width,e=controlPadElement.height,n=context.createLinearGradient(0,0,t,e);n.addColorStop(0,"rgb(200, 0, 90)"),n.addColorStop(.5,"rgb(164, 0, 0)"),n.addColorStop(1,"rgb(140, 70, 0)"),context.rect(0,0,t,e),context.fillStyle=n,context.fill();var o=function(){var n=context.createLinearGradient(0,0,t,e);n.addColorStop(0,"rgba(200, 0, 90, 0.15)"),n.addColorStop(.5,"rgba(164, 0, 0, 0.15)"),n.addColorStop(1,"rgba(140, 70, 0, 0.15)"),context.rect(0,0,t,e),context.fillStyle=n,context.fill()};fadeLoopIsOn=!0,function a(){fadeLoopIsOn&&(window.requestAnimationFrame(a),drawTouchCircle(),o())}(),controlPadElement.oncontextmenu=function(t){return t.preventDefault()}}},{key:"componentWillUnmount",value:function(){fadeLoopIsOn=!1}},{key:"handleInput",value:function(t){if(mouseInputEnabled="mousedown"===t.type?!0:mouseInputEnabled,!(t.nativeEvent instanceof MouseEvent)||mouseInputEnabled){controlPadActive=!0,currentXYRatios=calculateXAndYRatio(t);var e=getNoteFromXYRatios(currentXYRatios),n=e.id,o=e.pitch;currentlyPlayingPitch!==o&&null!==currentlyPlayingPitch&&_noteController.stopNote({id:n,pitch:currentlyPlayingPitch}),currentlyPlayingPitch=o,_noteController.playNote(e)}}},{key:"handleInputEnd",value:function(t){mouseInputEnabled=!1,controlPadActive=!1,currentlyPlayingPitch=null,_noteController.stopNote(getNoteFromXYRatios(calculateXAndYRatio(t)))}},{key:"render",value:function(){return _react2["default"].createElement("div",{className:"center"},_react2["default"].createElement("canvas",{width:"768",height:"768",className:"control-pad",onTouchStart:this.handleInput,onTouchMove:this.handleInput,onMouseDown:this.handleInput,onMouseMove:this.handleInput,onTouchEnd:this.handleInputEnd,onMouseUp:this.handleInputEnd}))}}]),e}(_react2["default"].Component);exports["default"]=ControlPad,module.exports=exports["default"];